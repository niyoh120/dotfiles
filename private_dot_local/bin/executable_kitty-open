#!/bin/bash

function kitty_open() {
  BIN_PATH=/usr/local/bin
  WINDOW=($($BIN_PATH/yabai -m query --windows --space |jq '.[]|select(.app=="kitty" and .title!="WINDOW")|.id,."has-focus"'))
  
  if [[ ${#WINDOW} -eq 0 ]]; then
    open -a kitty.app -n --args -1 --instance-group default &>/dev/null & disown; 
    while [[ ${#WINDOW[@]} -ne 2 ]];
      do
        WINDOW=($($BIN_PATH/yabai -m query --windows --space |jq '.[]|select(.app=="kitty" and .title!="WINDOW")|.id,."has-focus"'))
      done
  elif [[ ${WINDOW[1]} == false ]]; then
    $BIN_PATH/yabai -m window "${WINDOW[0]}" --focus;
  fi
}

kitty_open